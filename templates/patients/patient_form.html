{% extends 'base.html' %}

{% block title %}{% if is_edit %}Bemorni tahrirlash{% else %}Yangi bemor{% endif %} - MedAI CRM{% endblock %}

{% block page_title %}{% if is_edit %}Bemorni tahrirlash{% else %}Yangi bemor qo'shish{% endif %}{% endblock %}
{% block page_subtitle %}{% if is_edit %}{{ patient.ism }} ma'lumotlarini yangilash{% else %}Yangi bemor ma'lumotlarini kiriting{% endif %}{% endblock %}

{% block content %}
<!-- Back Button -->
<a href="{% url 'patient_list' %}" class="inline-flex items-center gap-2 text-slate-600 hover:text-slate-800 transition-colors mb-6">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
    </svg>
    Bemorlar ro'yxatiga qaytish
</a>

<div class="max-w-3xl">
    <div class="card rounded-2xl overflow-hidden">
        <div class="p-6 border-b border-slate-100 bg-gradient-to-r from-primary-50 to-violet-50">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-primary-500 to-violet-600 flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-slate-800 font-display">{% if is_edit %}Bemor ma'lumotlarini yangilash{% else %}Yangi bemor ro'yxatga olish{% endif %}</h2>
                    <p class="text-sm text-slate-500">Barcha kerakli maydonlarni to'ldiring</p>
                </div>
            </div>
        </div>

        <form method="post" class="p-6 space-y-6">
            {% csrf_token %}
            
            <!-- Personal Info Section -->
            <div>
                <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-4">Shaxsiy ma'lumotlar</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-slate-700 mb-2">To'liq ism *</label>
                        <input type="text" name="ism" value="{{ patient.ism|default:'' }}" required
                               class="form-input" placeholder="Familiya Ism Sharif">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Yosh *</label>
                        <input type="number" name="yosh" value="{{ patient.yosh|default:'' }}" required min="0" max="150"
                               class="form-input" placeholder="25">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Jins *</label>
                        <select name="jins" required class="form-input">
                            <option value="">Tanlang</option>
                            <option value="E" {% if patient.jins == 'E' %}selected{% endif %}>Erkak</option>
                            <option value="A" {% if patient.jins == 'A' %}selected{% endif %}>Ayol</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Telefon *</label>
                        <input type="tel" name="telefon" value="{{ patient.telefon|default:'' }}" required
                               class="form-input" placeholder="+998 90 123 45 67">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Qon guruhi</label>
                        <select name="qon_guruhi" class="form-input">
                            <option value="">Noma'lum</option>
                            {% for value, label in patient.QON_GURUHI_CHOICES %}
                            <option value="{{ value }}" {% if patient.qon_guruhi == value %}selected{% endif %}>{{ label }}</option>
                            {% empty %}
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-slate-700 mb-2">Manzil</label>
                        <textarea name="manzil" rows="2" class="form-input" placeholder="Toshkent sh., Chilonzor tumani...">{{ patient.manzil|default:'' }}</textarea>
                    </div>
                </div>
            </div>

            <!-- Medical Info Section -->
            <div class="pt-6 border-t border-slate-100">
                <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-4">Tibbiy ma'lumotlar</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Allergiyalar</label>
                        <textarea name="allergiyalar" rows="2" class="form-input" placeholder="Penisilin, aspirin...">{{ patient.allergiyalar|default:'' }}</textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <label class="flex items-center gap-3 p-4 rounded-xl border border-slate-200 hover:border-primary-300 hover:bg-primary-50 cursor-pointer transition-all">
                            <input type="checkbox" name="qand_kasalligi" {% if patient.qand_kasalligi %}checked{% endif %}
                                   class="w-5 h-5 text-primary-600 rounded border-slate-300 focus:ring-primary-500">
                            <div>
                                <span class="font-medium text-slate-700">Qand kasalligi</span>
                                <p class="text-xs text-slate-500">Diabet</p>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-4 rounded-xl border border-slate-200 hover:border-primary-300 hover:bg-primary-50 cursor-pointer transition-all">
                            <input type="checkbox" name="gipertoniya" {% if patient.gipertoniya %}checked{% endif %}
                                   class="w-5 h-5 text-primary-600 rounded border-slate-300 focus:ring-primary-500">
                            <div>
                                <span class="font-medium text-slate-700">Gipertoniya</span>
                                <p class="text-xs text-slate-500">Yuqori qon bosimi</p>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-4 rounded-xl border border-slate-200 hover:border-primary-300 hover:bg-primary-50 cursor-pointer transition-all">
                            <input type="checkbox" name="yurak_kasalligi" {% if patient.yurak_kasalligi %}checked{% endif %}
                                   class="w-5 h-5 text-primary-600 rounded border-slate-300 focus:ring-primary-500">
                            <div>
                                <span class="font-medium text-slate-700">Yurak kasalligi</span>
                                <p class="text-xs text-slate-500">Kardiovaskulyar</p>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex items-center justify-end gap-3 pt-6 border-t border-slate-100">
                <a href="{% url 'patient_list' %}" class="btn-secondary">Bekor qilish</a>
                <button type="submit" class="btn-primary inline-flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    {% if is_edit %}Saqlash{% else %}Qo'shish{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
