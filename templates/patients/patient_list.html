{% extends 'base.html' %}
{% block title %}Пациенты · Healthcare CRM{% endblock %}
{% block breadcrumb %}Модули / Пациенты{% endblock %}
{% block header %}Пациенты{% endblock %}

{% block content %}
<div class="card p-5">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h2 class="text-lg font-semibold">Список пациентов</h2>
      <p class="text-sm text-slate-600">Поиск по имени или телефону.</p>
    </div>
    <a class="btn btn-primary" href="{% url 'patient_create' %}">
      <i class="fa-solid fa-plus"></i> Новый пациент
    </a>
  </div>

  <form class="mt-4" method="get">
    <div class="flex gap-2">
      <input
        class="input flex-1"
        type="text"
        name="q"
        value="{{ query }}"
        placeholder="Поиск по имени или телефону..."
      />
      <button class="btn" type="submit">
        <i class="fa-solid fa-magnifying-glass"></i> Найти
      </button>
    </div>
  </form>

  <div class="mt-4 overflow-hidden rounded-2xl border border-slate-200">
    <table class="table">
      <thead>
        <tr>
          <th>Пациент</th>
          <th>Телефон</th>
          <th>Пол</th>
          <th>Возраст</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for p in patients %}
          <tr>
            <td>
              <div class="font-semibold">{{ p.ism }}</div>
              <div class="text-xs text-slate-500">ID: {{ p.id }}</div>
            </td>
            <td class="text-slate-700">{{ p.telefon|default:"—" }}</td>
            <td class="text-slate-700">{{ p.get_jins_display|default:p.jins }}</td>
            <td class="text-slate-700">{{ p.yosh }}</td>
            <td class="text-right">
              <a class="btn" href="{% url 'patient_detail' p.id %}">Открыть <i class="fa-solid fa-arrow-right"></i></a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="5" class="text-slate-600">Нет пациентов.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
