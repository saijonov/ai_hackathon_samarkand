{% extends 'base.html' %}

{% block title %}{% if is_edit %}Uchrashuvni tahrirlash{% else %}Yangi uchrashuv{% endif %} - MedAI CRM{% endblock %}

{% block page_title %}{% if is_edit %}Uchrashuvni tahrirlash{% else %}Yangi uchrashuv{% endif %}{% endblock %}
{% block page_subtitle %}{% if is_edit %}Ma'lumotlarni yangilash{% else %}Yangi uchrashuv yaratish{% endif %}{% endblock %}

{% block content %}
<!-- Back Button -->
<a href="{% url 'appointment_list' %}" class="inline-flex items-center gap-2 text-slate-600 hover:text-slate-800 transition-colors mb-6">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
    </svg>
    Uchrashuvlar ro'yxatiga qaytish
</a>

<div class="max-w-3xl">
    <div class="card rounded-2xl overflow-hidden">
        <div class="p-6 border-b border-slate-100 bg-gradient-to-r from-amber-50 to-orange-50">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-slate-800 font-display">{% if is_edit %}Uchrashuv ma'lumotlari{% else %}Yangi uchrashuv{% endif %}</h2>
                    <p class="text-sm text-slate-500">AI avtomatik xavf darajasini hisoblaydi</p>
                </div>
            </div>
        </div>

        <form method="post" class="p-6 space-y-6">
            {% csrf_token %}
            
            <!-- Patient Selection -->
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Bemor *</label>
                {% if is_edit %}
                <input type="text" value="{{ appointment.bemor.ism }}" disabled class="form-input bg-slate-50">
                {% else %}
                <select name="bemor_id" required class="form-input">
                    <option value="">Bemorni tanlang</option>
                    {% for patient in patients %}
                    <option value="{{ patient.pk }}">{{ patient.ism }} ({{ patient.yosh }} yosh, {{ patient.telefon }})</option>
                    {% endfor %}
                </select>
                {% endif %}
            </div>

            <!-- Date and Time -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Sana va vaqt *</label>
                    <input type="datetime-local" name="uchrashuv_sanasi" required
                           value="{% if appointment %}{{ appointment.uchrashuv_sanasi|date:'Y-m-d\TH:i' }}{% endif %}"
                           class="form-input">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Bo'lim *</label>
                    <select name="bolim" required class="form-input">
                        <option value="">Tanlang</option>
                        <option value="terapiya" {% if appointment.bolim == 'terapiya' %}selected{% endif %}>Terapiya</option>
                        <option value="kardiologiya" {% if appointment.bolim == 'kardiologiya' %}selected{% endif %}>Kardiologiya</option>
                        <option value="endokrinologiya" {% if appointment.bolim == 'endokrinologiya' %}selected{% endif %}>Endokrinologiya</option>
                        <option value="nevrologiya" {% if appointment.bolim == 'nevrologiya' %}selected{% endif %}>Nevrologiya</option>
                        <option value="pediatriya" {% if appointment.bolim == 'pediatriya' %}selected{% endif %}>Pediatriya</option>
                        <option value="ginekologiya" {% if appointment.bolim == 'ginekologiya' %}selected{% endif %}>Ginekologiya</option>
                        <option value="boshqa" {% if appointment.bolim == 'boshqa' %}selected{% endif %}>Boshqa</option>
                    </select>
                </div>
            </div>

            <!-- Doctor -->
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Shifokor *</label>
                <input type="text" name="shifokor" required
                       value="{{ appointment.shifokor|default:'' }}"
                       class="form-input" placeholder="Dr. Aliyev Bobur">
            </div>

            <!-- SMS Option -->
            <div class="pt-4 border-t border-slate-100">
                <label class="flex items-center gap-3 p-4 rounded-xl border border-slate-200 hover:border-primary-300 hover:bg-primary-50 cursor-pointer transition-all">
                    <input type="checkbox" name="sms_yuborildi" {% if appointment.sms_yuborildi %}checked{% endif %}
                           class="w-5 h-5 text-primary-600 rounded border-slate-300 focus:ring-primary-500">
                    <div>
                        <span class="font-medium text-slate-700">SMS eslatma yuborish</span>
                        <p class="text-xs text-slate-500">Bemorga uchrashuv haqida SMS xabar yuboriladi</p>
                    </div>
                </label>
            </div>

            <!-- Notes -->
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Izoh</label>
                <textarea name="izoh" rows="3" class="form-input" placeholder="Qo'shimcha ma'lumotlar...">{{ appointment.izoh|default:'' }}</textarea>
            </div>

            <!-- AI Info -->
            {% if not is_edit %}
            <div class="p-4 rounded-xl bg-gradient-to-r from-violet-50 to-purple-50 border border-violet-100">
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 rounded-lg bg-violet-100 flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-violet-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="font-medium text-violet-800">AI Xavf bashorati</p>
                        <p class="text-sm text-violet-600 mt-1">Uchrashuv yaratilganda AI bemorning kelmay qolish xavfini avtomatik hisoblaydi va yuqori xavf bo'lsa ogohlantiradi.</p>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Submit Button -->
            <div class="flex items-center justify-end gap-3 pt-6 border-t border-slate-100">
                <a href="{% url 'appointment_list' %}" class="btn-secondary">Bekor qilish</a>
                <button type="submit" class="btn-primary inline-flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    {% if is_edit %}Saqlash{% else %}Yaratish{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
