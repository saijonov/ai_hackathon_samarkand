{% extends 'base.html' %}
{% block title %}Запись · Форма{% endblock %}
{% block breadcrumb %}Модули / <a class="text-blue-600 hover:underline" href="{% url 'appointment_list' %}">Записи</a> / Форма{% endblock %}
{% block header %}{% if appointment %}Редактировать запись{% else %}Новая запись{% endif %}{% endblock %}

{% block content %}
<div class="card p-5 max-w-3xl">
  <form method="post" class="space-y-5">
    {% csrf_token %}

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div class="sm:col-span-2">
        <label class="text-xs font-semibold text-slate-600">Пациент (bemor)</label>
        <select class="input" name="bemor" required>
          {% for p in patients %}
            <option value="{{ p.id }}" {% if appointment and appointment.bemor.id == p.id %}selected{% endif %}>
              {{ p.ism }} · {{ p.telefon }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label class="text-xs font-semibold text-slate-600">Дата/время (uchrashuv_sanasi)</label>
        <input class="input" type="datetime-local" name="uchrashuv_sanasi"
               value="{% if appointment %}{{ appointment.uchrashuv_sanasi|date:'Y-m-d\TH:i' }}{% endif %}" required />
      </div>

      <div>
        <label class="text-xs font-semibold text-slate-600">Отдел (bolim)</label>
        <select class="input" name="bolim" required>
          {% with current=appointment.bolim %}
          <option value="terapiya" {% if current == 'terapiya' %}selected{% endif %}>Terapiya</option>
          <option value="kardiologiya" {% if current == 'kardiologiya' %}selected{% endif %}>Kardiologiya</option>
          <option value="endokrinologiya" {% if current == 'endokrinologiya' %}selected{% endif %}>Endokrinologiya</option>
          <option value="nevrologiya" {% if current == 'nevrologiya' %}selected{% endif %}>Nevrologiya</option>
          <option value="pediatriya" {% if current == 'pediatriya' %}selected{% endif %}>Pediatriya</option>
          <option value="ginekologiya" {% if current == 'ginekologiya' %}selected{% endif %}>Ginekologiya</option>
          <option value="boshqa" {% if current == 'boshqa' %}selected{% endif %}>Boshqa</option>
          {% endwith %}
        </select>
      </div>

      <div class="sm:col-span-2">
        <label class="text-xs font-semibold text-slate-600">Врач (shifokor)</label>
        <input class="input" name="shifokor" value="{% if appointment %}{{ appointment.shifokor }}{% endif %}" placeholder="Dr. ..." />
      </div>

      <div class="sm:col-span-2">
        <label class="text-xs font-semibold text-slate-600">Комментарий (izoh)</label>
        <textarea class="input" name="izoh" rows="3">{% if appointment %}{{ appointment.izoh }}{% endif %}</textarea>
      </div>

      <div class="sm:col-span-2">
        <label class="flex items-center gap-2 rounded-2xl border border-slate-200 bg-slate-50 p-3">
          <input type="checkbox" name="sms_yuborildi" {% if appointment and appointment.sms_yuborildi %}checked{% endif %} />
          <span class="text-sm">SMS yuborildi</span>
        </label>
      </div>
    </div>

    <div class="flex gap-2">
      <button class="btn btn-primary" type="submit"><i class="fa-solid fa-check"></i> Сохранить</button>
      <a class="btn" href="{% url 'appointment_list' %}">Отмена</a>
    </div>
  </form>
</div>
{% endblock %}
