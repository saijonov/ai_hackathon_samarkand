{% extends 'base.html' %}
{% block title %}Записи · Healthcare CRM{% endblock %}
{% block breadcrumb %}Модули / Записи{% endblock %}
{% block header %}Записи{% endblock %}

{% block content %}
<div class="card p-5">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h2 class="text-lg font-semibold">Список записей</h2>
      <p class="text-sm text-slate-600">Фильтры и управление статусом.</p>
    </div>
    <a class="btn btn-primary" href="{% url 'appointment_create' %}">
      <i class="fa-regular fa-calendar-plus"></i> Новая запись
    </a>
  </div>

  <form class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3" method="get">
    <select class="input" name="holat">
      <option value="">Все статусы</option>
      <option value="rejalashtirilgan" {% if holat == 'rejalashtirilgan' %}selected{% endif %}>Rejalashtirilgan</option>
      <option value="yakunlangan" {% if holat == 'yakunlangan' %}selected{% endif %}>Yakunlangan</option>
      <option value="bekor_qilingan" {% if holat == 'bekor_qilingan' %}selected{% endif %}>Bekor qilingan</option>
      <option value="kelmadi" {% if holat == 'kelmadi' %}selected{% endif %}>Kelmadi</option>
    </select>

    <select class="input" name="risk">
      <option value="">Любой риск</option>
      <option value="past" {% if risk == 'past' %}selected{% endif %}>Низкий</option>
      <option value="orta" {% if risk == 'orta' %}selected{% endif %}>Средний</option>
      <option value="yuqori" {% if risk == 'yuqori' %}selected{% endif %}>Высокий</option>
    </select>

    <select class="input" name="date">
      <option value="">Любая дата</option>
      <option value="bugun" {% if date_filter == 'bugun' %}selected{% endif %}>Сегодня</option>
      <option value="ertaga" {% if date_filter == 'ertaga' %}selected{% endif %}>Завтра</option>
      <option value="hafta" {% if date_filter == 'hafta' %}selected{% endif %}>Неделя</option>
    </select>

    <button class="btn sm:col-span-3 justify-center" type="submit">
      <i class="fa-solid fa-filter"></i> Применить
    </button>
  </form>

  <div class="mt-4 overflow-hidden rounded-2xl border border-slate-200">
    <table class="table">
      <thead>
        <tr>
          <th>Пациент</th>
          <th>Дата</th>
          <th>Отдел</th>
          <th>Статус</th>
          <th>Риск</th>
          <th class="text-right">Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for a in appointments %}
          <tr>
            <td class="font-semibold">
              <a class="text-blue-600 hover:underline" href="{% url 'patient_detail' a.bemor.id %}">
                {{ a.bemor.ism }}
              </a>
            </td>
            <td class="text-slate-700">{{ a.uchrashuv_sanasi|date:"d.m.Y H:i" }}</td>
            <td class="text-slate-700">{{ a.get_bolim_display }}</td>
            <td class="text-slate-700">{{ a.get_holat_display }}</td>
            <td class="text-slate-700">{{ a.kelmay_qolish_riski|floatformat:2 }}</td>
            <td class="text-right space-x-2">
              <a class="btn" href="{% url 'appointment_edit' a.id %}"><i class="fa-regular fa-pen-to-square"></i></a>
              <a class="btn" href="{% url 'appointment_complete' a.id %}"><i class="fa-solid fa-check"></i></a>
              <a class="btn" href="{% url 'appointment_cancel' a.id %}"><i class="fa-solid fa-xmark"></i></a>
              <a class="btn" href="{% url 'appointment_noshow' a.id %}"><i class="fa-solid fa-triangle-exclamation"></i></a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6" class="text-slate-600">Нет записей.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
