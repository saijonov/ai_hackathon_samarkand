{% extends 'base.html' %}
{% block title %}Дашборд · Healthcare CRM{% endblock %}
{% block breadcrumb %}Главная / Дашборд{% endblock %}
{% block header %}Дашборд{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <section class="card p-5 lg:col-span-2">
    <div class="flex items-start justify-between gap-4">
      <div>
        <h2 class="text-lg font-semibold">Сводка на сегодня</h2>
        <p class="text-sm text-slate-600 mt-1">Статистика по пациентам и встречам (appointments).</p>
      </div>
      <div class="flex gap-2">
        <a class="btn btn-primary" href="{% url 'patient_create' %}">
          <i class="fa-solid fa-plus"></i> Пациент
        </a>
        <a class="btn" href="{% url 'appointment_create' %}">
          <i class="fa-regular fa-calendar-plus"></i> Запись
        </a>
      </div>
    </div>

    <div class="mt-6 grid grid-cols-1 sm:grid-cols-4 gap-4">
      <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
        <div class="text-xs text-slate-500">Пациентов</div>
        <div class="text-2xl font-bold mt-1">{{ total_patients|default:"—" }}</div>
      </div>
      <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
        <div class="text-xs text-slate-500">Записей сегодня</div>
        <div class="text-2xl font-bold mt-1">{{ today_appointments|default:"—" }}</div>
      </div>
      <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
        <div class="text-xs text-slate-500">High risk</div>
        <div class="text-2xl font-bold mt-1">{{ high_risk_count|default:"—" }}</div>
      </div>
      <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
        <div class="text-xs text-slate-500">Завершено</div>
        <div class="text-2xl font-bold mt-1">{{ completed_today|default:"—" }}</div>
      </div>
    </div>

    <div class="mt-6">
      <h3 class="font-semibold">Сегодняшние записи</h3>
      <div class="mt-3 overflow-hidden rounded-2xl border border-slate-200">
        <table class="table">
          <thead>
            <tr>
              <th>Пациент</th>
              <th>Время</th>
              <th>Отдел</th>
              <th>Риск no-show</th>
            </tr>
          </thead>
          <tbody>
            {% for a in todays_appointments %}
              <tr>
                <td class="font-semibold">
                  <a class="text-blue-600 hover:underline" href="{% url 'patient_detail' a.bemor.id %}">{{ a.bemor.ism }}</a>
                </td>
                <td class="text-slate-700">{{ a.uchrashuv_sanasi|date:"d.m.Y H:i" }}</td>
                <td class="text-slate-700">{{ a.get_bolim_display|default:a.bolim }}</td>
                <td class="text-slate-700">{{ a.kelmay_qolish_riski|floatformat:2 }}</td>
              </tr>
            {% empty %}
              <tr><td colspan="4" class="text-slate-600">На сегодня записей нет.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <aside class="card p-5">
    <h2 class="text-lg font-semibold">High-risk список</h2>
    <p class="text-sm text-slate-600 mt-1">Те, у кого риск неявки высокий.</p>

    <div class="mt-4 space-y-2">
      {% for a in high_risk_appointments %}
        <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
          <div class="flex items-center justify-between gap-3">
            <div>
              <div class="font-semibold">{{ a.bemor.ism }}</div>
              <div class="text-xs text-slate-500">{{ a.uchrashuv_sanasi|date:"d.m.Y H:i" }} · {{ a.get_bolim_display }}</div>
            </div>
            <span class="badge badge-warn">{{ a.kelmay_qolish_riski|floatformat:2 }}</span>
          </div>
        </div>
      {% empty %}
        <div class="text-sm text-slate-600">Нет high-risk записей на сегодня.</div>
      {% endfor %}
    </div>
  </aside>
</div>
{% endblock %}
